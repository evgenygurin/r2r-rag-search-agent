# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-11-27
**–í–µ—Ç–∫–∞:** dev
**–ö–æ–º–º–∏—Ç:** c08a2f9 - fix: –ø–µ—Ä–µ–¥–∞—á–∞ authenticated AsyncClient –≤ FastMCP.from_openapi –¥–ª—è runtime –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

Runtime 401 Unauthorized –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `r2r_openapi_server.py`:

```python
# –î–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
mcp = FastMCP.from_openapi(
    openapi_spec=openapi_spec,
    name="R2R OpenAPI Server",
    httpx_client_kwargs={...}  # Headers –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å
)

# –ü–û–°–õ–ï (—Ä–∞–±–æ—Ç–∞–µ—Ç):
client = httpx.AsyncClient(
    base_url=R2R_BASE_URL,
    headers=headers,  # Authorization header
    timeout=30.0,
)

mcp = FastMCP.from_openapi(
    openapi_spec=openapi_spec,
    client=client,  # –ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∫–ª–∏–µ–Ω—Ç–∞ —Å headers
    name="R2R OpenAPI Server",
)
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –¢–µ—Å—Ç 1: HTTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (test_auth.py)

```text
–¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚úÖ OpenAPI spec –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
   –í–µ—Ä—Å–∏—è: 3.1.0
   Endpoints: 81

–¢–µ—Å—Ç 2: AsyncClient —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (health check)
‚úÖ Health check: 404
   ‚ÑπÔ∏è  Endpoint /v3/system/health –Ω–µ –Ω–∞–π–¥–µ–Ω (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

–¢–µ—Å—Ç 3: –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ API
‚úÖ –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ
   Status: 200
   –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ: 5

–¢–µ—Å—Ç 4: –ó–∞–ø—Ä–æ—Å –ë–ï–ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–∂–∏–¥–∞–µ—Ç—Å—è 401)
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: 401 Unauthorized –±–µ–∑ API –∫–ª—é—á–∞
```

**–í—ã–≤–æ–¥:** HTTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. AsyncClient —Å headers —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ R2R API.

### ‚úÖ –¢–µ—Å—Ç 2: MCP —Å–µ—Ä–≤–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (test_mcp_tools.py)

```text
–¢–µ—Å—Ç 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞
‚úÖ MCP —Å–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: R2R OpenAPI Server
   –¢–∏–ø: FastMCPOpenAPI

–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ AsyncClient –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚úÖ AsyncClient –Ω–∞—Å—Ç—Ä–æ–µ–Ω
   Base URL: http://136.119.36.216:7272
   Headers: {
     'authorization': 'Bearer key_bsDbiLdGpOgKr9Warewg-w==.ICSVjSbhpVGm7at0i6uzuUKHJb4Oh5mfcfZ64yb3ULI=',
     'content-type': 'application/json',
     ...
   }
‚úÖ Authorization header –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –≤–∞–ª–∏–¥–µ–Ω
```

**–í—ã–≤–æ–¥:** MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å AsyncClient, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º Authorization header. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

### ‚úÖ –¢–µ—Å—Ç 3: MCP Inspector (manual testing)

```bash
Starting MCP inspector...
‚öôÔ∏è Proxy server listening on localhost:6277
üîë Session token: c1c3f58943289d41532d90949857fad8fe2680a76689a64fc9b9a90cd7e43be5

üöÄ MCP Inspector is up and running at:
   http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=...

üåê Opening browser...
New STDIO connection request
STDIO transport: command=/Users/laptop/.pyenv/shims/uv, args=run,python,r2r_openapi_server.py
Created client transport
Created server transport
Received POST message for sessionId 8e8887ba-848d-4ca1-ac9a-1e06efb95807
[19+ successful POST messages received]
```

**–í—ã–≤–æ–¥:** MCP Inspector —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ø–æ–ª—É—á–∞–µ—Ç POST —Å–æ–æ–±—â–µ–Ω–∏—è. –°–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
2. **AsyncClient –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** Headers –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ httpx.AsyncClient
3. **Authorization header:** –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `Bearer <token>`
4. **Base URL:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `http://136.119.36.216:7272`
5. **MCP Inspector:** –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
6. **API –∑–∞–ø—Ä–æ—Å—ã:** `/v3/documents` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK —Å –¥–∞–Ω–Ω—ã–º–∏

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ –ó–∞–ø—Ä–æ—Å –ë–ï–ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ AsyncClient –≤ FastMCP.from_openapi()
- ‚úÖ MCP Inspector –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ STDIO

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

–ü—Ä–æ–±–ª–µ–º–∞ runtime 401 Unauthorized errors —Ä–µ—à–µ–Ω–∞ –ø—É—Ç–µ–º –ø—Ä—è–º–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ AsyncClient —Å Authorization headers –≤ –º–µ—Ç–æ–¥ `FastMCP.from_openapi()`. –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç, —á—Ç–æ:

1. HTTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
3. Authorization header –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –≤–∞–ª–∏–¥–µ–Ω
4. MCP Inspector —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ **–ú–µ—Ä–∂–∏—Ç—å PR #4 –≤ main** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ **–£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã** - test_auth.py, test_mcp_tools.py –ø–æ—Å–ª–µ –º–µ—Ä–∂–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - –µ—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## –§–∞–π–ª—ã –≤ –∫–æ–º–º–∏—Ç–µ

- `r2r_openapi_server.py` - –æ—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `server.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (E501 line length fixes)

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã

- c08a2f9 - fix: –ø–µ—Ä–µ–¥–∞—á–∞ authenticated AsyncClient –≤ FastMCP.from_openapi –¥–ª—è runtime –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- a33290b - style: fix E501 line length errors in server.py
- 784d28a - fix: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è OpenAPI spec –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ IPv6 –æ—à–∏–±–∫–∞
